<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>Configure Biome for Linting and Formatting</title>
    <status>drafted</status>
    <generatedAt>2025-11-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-2-configure-biome-for-linting-and-formatting.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>Biome configured for code quality</iWant>
    <soThat>all code follows consistent standards automatically</soThat>
    <tasks>
      <task id="1" ac="1,2,3">
        <description>Create biome.json configuration file</description>
        <subtasks>
          <subtask>Set up project-specific linting rules</subtask>
          <subtask>Enable TypeScript linting</subtask>
          <subtask>Configure formatting to match ESNext and strict mode</subtask>
          <subtask>Set indentation, line width, and quote style</subtask>
        </subtasks>
      </task>
      <task id="2" ac="6">
        <description>Configure exclusion patterns</description>
        <subtasks>
          <subtask>Exclude node_modules directory</subtask>
          <subtask>Exclude .git directory</subtask>
          <subtask>Exclude build/dist directories</subtask>
        </subtasks>
      </task>
      <task id="3" ac="4,5">
        <description>Verify Biome commands work</description>
        <subtasks>
          <subtask>Test `bun biome check .` command</subtask>
          <subtask>Test `bun biome format --write .` command</subtask>
          <subtask>Run biome check on existing code</subtask>
        </subtasks>
      </task>
      <task id="4" ac="">
        <description>Add npm scripts for convenience</description>
        <subtasks>
          <subtask>Add lint script to package.json</subtask>
          <subtask>Add format script to package.json</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">biome.json created with project-specific rules</criterion>
    <criterion id="2">Linting enabled for TypeScript files</criterion>
    <criterion id="3">Formatting rules match architecture decisions (ESNext, strict mode)</criterion>
    <criterion id="4">`bun biome check .` command works</criterion>
    <criterion id="5">`bun biome format --write .` command works</criterion>
    <criterion id="6">Configuration excludes node_modules, .git, build directories</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision 3: Code Quality</section>
        <snippet>Biome 2.3.2 selected as all-in-one linter and formatter, 100x faster than ESLint+Prettier combination. Single tool to maintain, native TypeScript support, and excellent performance with Bun runtime.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision 12: File Naming Conventions</section>
        <snippet>Code files use camelCase (e.g., browserAgent.ts), output files use kebab-case. TypeScript with ESNext target and strict mode enabled.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 1: Project Foundation & Infrastructure</section>
        <snippet>Story 1.2 configures Biome for automatic code quality enforcement, following the selection made in architecture decisions.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>package.json</path>
        <kind>configuration</kind>
        <symbol>package manifest</symbol>
        <lines>1-26</lines>
        <reason>Contains @biomejs/biome@2.3.2 in devDependencies. Will be updated to add lint and format scripts.</reason>
      </artifact>
      <artifact>
        <path>tsconfig.json</path>
        <kind>configuration</kind>
        <symbol>TypeScript configuration</symbol>
        <lines>1-15</lines>
        <reason>TypeScript configuration with strict mode and ESNext target. Biome formatting must align with these settings.</reason>
      </artifact>
      <artifact>
        <path>package.test.ts</path>
        <kind>test</kind>
        <symbol>dependency tests</symbol>
        <lines>1-74</lines>
        <reason>Existing test file with mixed import styles (require vs import). Biome will help enforce consistency.</reason>
      </artifact>
      <artifact>
        <path>index.ts</path>
        <kind>entry-point</kind>
        <symbol>main entry</symbol>
        <lines>1-2</lines>
        <reason>Bun starter entry point. Biome will format this file.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="Node.js/Bun">
        <current>
          <package name="@biomejs/biome" version="2.3.2" scope="dev" />
          <package name="typescript" version="^5" scope="peer" />
          <package name="vitest" version="4.0" scope="dev" />
        </current>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Biome configuration must align with TypeScript strict mode and ESNext target from tsconfig.json</constraint>
    <constraint>Must exclude node_modules/, .git/, and build directories from linting/formatting</constraint>
    <constraint>Configuration should enable all recommended TypeScript linting rules</constraint>
    <constraint>Formatting must be consistent with architecture file naming conventions (camelCase for code)</constraint>
    <constraint>Should not break existing code - run format command to align existing files with new standards</constraint>
    <constraint>Commands must work with Bun runtime (bun biome check, bun biome format)</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>biome.json schema</name>
      <kind>configuration</kind>
      <signature>
{
  "$schema": "https://biomejs.dev/schemas/1.9.4/schema.json",
  "files": {
    "ignore": ["node_modules", ".git", "build", "dist", "coverage", "bun.lock"]
  },
  "formatter": {
    "enabled": true,
    "indentStyle": "space",
    "indentWidth": 2,
    "lineWidth": 80
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true
    }
  },
  "javascript": {
    "formatter": {
      "quoteStyle": "double",
      "semicolons": "always"
    }
  }
}
      </signature>
      <path>biome.json</path>
    </interface>
    <interface>
      <name>package.json scripts (lint/format)</name>
      <kind>configuration</kind>
      <signature>
{
  "scripts": {
    "test": "bun test",
    "test:coverage": "bun test --coverage",
    "lint": "bun biome check .",
    "lint:fix": "bun biome check --write .",
    "format": "bun biome format --write ."
  }
}
      </signature>
      <path>package.json</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing framework is Vitest 4.0. This story configures code quality tooling (Biome), so tests should verify the configuration works correctly. Tests can check that biome.json exists, has correct structure, and that Biome commands execute successfully.
    </standards>
    <locations>
      <location>biome.config.test.ts (if comprehensive testing desired)</location>
      <location>Inline verification via bash commands (simpler approach)</location>
    </locations>
    <ideas>
      <idea ac="1">Verify biome.json file exists and is valid JSON</idea>
      <idea ac="1,2,3">Parse biome.json and verify linting enabled, formatter configured, TypeScript rules present</idea>
      <idea ac="4">Execute `bun biome check .` and verify exit code is 0 or non-zero (depending on code state)</idea>
      <idea ac="5">Execute `bun biome format --write .` and verify it completes without errors</idea>
      <idea ac="6">Verify biome.json contains ignore patterns for node_modules, .git, build</idea>
    </ideas>
  </tests>
</story-context>
